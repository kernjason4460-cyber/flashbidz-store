<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FlashBidz Store — Local Deals • Mattawan, MI</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <meta name="description" content="FlashBidz — fixed-price local deals with easy pickup in Mattawan, MI." />
</head>
<body>
  <header class="site-header">
    <a class="brand" href="#top">
      <img src="img/flashbidz_logo.svg" alt="FlashBidz" class="logoimg" />
      <div class="name">
        <h1>FlashBidz Store</h1>
        <p class="tagline">Neighbors Helping Neighbors • Mattawan, MI</p>
      </div>
    </a>
    <nav class="top-cta">
      <a class="btn btn-primary" href="#shop">Shop</a>
      <a class="btn" href="#pickup">Pickup Info</a>
      <a class="btn" href="https://www.facebook.com/flashbidz.mattawan" target="_blank" rel="noopener">Message on Facebook</a>
    </nav>
  </header>

  <section class="hero" id="top">
    <h2>Local Deals • Easy Pickup • No Bidding</h2>
    <p>Prices shown are <strong>before tax</strong>. Michigan sales tax is added at checkout for Venmo/Cash App.</p>
    <div class="hero-cta">
      <input id="q" class="search" type="search" placeholder="Search items… (e.g., bassinet, tools, Barbie)" aria-label="Search products" />
      <a class="btn btn-primary" href="#shop" onclick="document.getElementById('q').focus()">Browse All</a>
    </div>
  </section>

  <main id="shop" class="container">
    <div class="toolbar">
      <select id="cat" class="select">
        <option value="">All categories</option>
      </select>
      <select id="sort" class="select">
        <option value="new">Newest</option>
        <option value="price-asc">Price: Low to High</option>
        <option value="price-desc">Price: High to Low</option>
      </select>
      <span id="count" class="count"></span>
    </div>
    <div id="product-grid" class="grid" aria-live="polite"></div>
  </main>

  <section id="pickup" class="pickup container">
    <h3>Pickup, Payment & Policies</h3>
    <ul>
      <li><strong>Pickup:</strong> Mattawan, MI (exact address provided after purchase). Please pick up within <strong>7 days</strong>.</li>
      <li><strong>Storage:</strong> After 7 days, <strong>$2 per item per day</strong>. After 14 days, items are <strong>abandoned</strong>.</li>
      <li><strong>Payment:</strong> Pay with <strong>Venmo or Cash App</strong>. MI <strong>6% sales tax</strong> is added at checkout.</li>
      <li><strong>Condition:</strong> Items sold <em>AS‑IS, WHERE‑IS</em>. <strong>All sales final.</strong></li>
      <li><strong>Questions?</strong> Message us on Facebook or email <a href="mailto:support@flashbidz.net">support@flashbidz.net</a>.</li>
    </ul>
  </section>

  <footer class="site-footer">
    <p>© <span id="year"></span> FlashBidz of Mattawan • All sales final • AS‑IS, WHERE‑IS</p>
  </footer>

  <template id="product-card-tpl">
    <article class="card">
      <div class="img-wrap">
        <img src="" alt="" loading="lazy" />
        <span class="badge"></span>
      </div>
      <div class="card-body">
        <h4 class="title"></h4>
        <p class="desc"></p>
        <div class="meta">
          <span class="price"></span>
          <span class="stock"></span>
        </div>

        <div class="totals">
          <div>Subtotal: <strong class="subtotal"></strong></div>
          <div>MI Sales Tax (<span class="tax-rate"></span>%): <strong class="tax"></strong></div>
          <div>Total: <strong class="total"></strong></div>
        </div>

        <div class="actions two">
          <a class="btn pay venmo" target="_blank" rel="noopener">Pay with Venmo</a>
          <a class="btn pay cashapp" target="_blank" rel="noopener">Pay with Cash App</a>
        </div>
      </div>
    </article>
  </template>

  <script>
    // Settings: your real handles + tax rate
    const CASH_APP_TAG = "FlashBidz";     // without the $
    const VENMO_USER  = "FlashBidz";      // venmo.com/u/FlashBidz
    const MI_TAX_RATE = 0.06;             // 6%

    const YEAR_EL = document.getElementById('year');
    YEAR_EL.textContent = new Date().getFullYear();

    const grid = document.getElementById('product-grid');
    const tpl = document.getElementById('product-card-tpl');
    const q = document.getElementById('q');
    const cat = document.getElementById('cat');
    const sortSel = document.getElementById('sort');
    const countEl = document.getElementById('count');

    let PRODUCTS = [];
    function fmt(n){ return '$' + (Number(n)||0).toFixed(2); }

    async function loadProducts() {
      const res = await fetch('products.json?' + Date.now());
      const data = await res.json();
      PRODUCTS = data.products || [];

      const cats = Array.from(new Set(PRODUCTS.flatMap(p => p.categories || []))).sort();
      cats.forEach(c => {
        const o = document.createElement('option');
        o.value = c; o.textContent = c;
        cat.appendChild(o);
      });

      render();
    }

    function buildVenmoLink(amount, note) {
      if (!VENMO_USER) return '';
      return `https://venmo.com/u/${VENMO_USER}?txn=pay&amount=${(amount||0).toFixed(2)}&note=${encodeURIComponent(note)}`;
    }
    function buildCashAppLink(amount, note) {
      if (!CASH_APP_TAG) return '';
      return `https://cash.app/$${CASH_APP_TAG}?amount=${(amount||0).toFixed(2)}&note=${encodeURIComponent(note)}`;
    }

    function render() {
      const query = (q.value || '').toLowerCase().trim();
      const selectedCat = cat.value;
      const sort = sortSel.value;

      let items = PRODUCTS.filter(p => (p.active !== false));

      if (selectedCat) items = items.filter(p => (p.categories || []).includes(selectedCat));
      if (query) items = items.filter(p => (p.title + ' ' + (p.description||'')).toLowerCase().includes(query));

      if (sort === 'price-asc') items.sort((a,b) => (a.price||0) - (b.price||0));
      else if (sort === 'price-desc') items.sort((a,b) => (b.price||0) - (a.price||0));
      else items.sort((a,b) => new Date(b.added_at||0) - new Date(a.added_at||0));

      grid.innerHTML = '';
      items.forEach(p => {
        const node = tpl.content.cloneNode(true);
        const img = node.querySelector('img');
        const title = node.querySelector('.title');
        const desc = node.querySelector('.desc');
        const price = node.querySelector('.price');
        const stock = node.querySelector('.stock');
        const badge = node.querySelector('.badge');
        const subEl = node.querySelector('.subtotal');
        const taxEl = node.querySelector('.tax');
        const totalEl = node.querySelector('.total');
        const taxRateEl = node.querySelector('.tax-rate');
        const venmoBtn = node.querySelector('.venmo');
        const cashBtn = node.querySelector('.cashapp');

        img.src = p.image || 'img/placeholder.png';
        img.alt = p.title;
        title.textContent = p.title;
        desc.textContent = p.description || '';
        price.textContent = p.price ? fmt(p.price) : '';
        stock.textContent = p.stock && p.stock > 0 ? 'In Stock' : 'Sold Out';
        if (p.badge) { badge.textContent = p.badge; } else { badge.remove(); }

        const subtotal = Number(p.price || 0);
        const tax = +(subtotal * MI_TAX_RATE).toFixed(2);
        const total = +(subtotal + tax).toFixed(2);
        taxRateEl.textContent = (MI_TAX_RATE * 100).toFixed(0);
        subEl.textContent = fmt(subtotal);
        taxEl.textContent = fmt(tax);
        totalEl.textContent = fmt(total);

        const note = `${p.sku || ''}-${p.title || ''}`.slice(0,60);

        if (p.stock && p.stock > 0) {
          const venmo = buildVenmoLink(total, note);
          const cash = buildCashAppLink(total, note);
          if (venmo) venmoBtn.href = venmo; else venmoBtn.classList.add('disabled');
          if (cash) cashBtn.href = cash; else cashBtn.classList.add('disabled');
        } else {
          venmoBtn.textContent = 'Sold Out'; venmoBtn.classList.add('disabled'); venmoBtn.removeAttribute('href');
          cashBtn.textContent = 'Sold Out';  cashBtn.classList.add('disabled');  cashBtn.removeAttribute('href');
        }

        grid.appendChild(node);
      });

      countEl.textContent = items.length + ' item' + (items.length===1?'':'s');
    }

    q.addEventListener('input', render);
    cat.addEventListener('change', render);
    sortSel.addEventListener('change', render);

    loadProducts();
  </script>
</body>
</html>
